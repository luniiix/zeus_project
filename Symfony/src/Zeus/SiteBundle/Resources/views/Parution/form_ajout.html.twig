{# src/Zeus/SiteBundle/Resources/views/Parution/ajouter.html.twig #}

{% block stylesheets %}
    {{ form_stylesheet(form) }}
{% endblock %}

{% block javascripts %}
    {{ form_javascript(form) }}
{% endblock %}

<script type="text/javascript">
    
    function maj_sous_cat_dispo()
    {
        idSousCategorie = $('form input[name=sous_cat]').val();
        $('form input[name=sous_cat]').val(0);
        idCategorie = $('#zeus_sitebundle_parution_categorie').val();
        $.ajax({
             type: "POST",
             url: Routing.generate('zeus_site_sous_categorie_dispo_ajax'),
             data : {idCategorie : idCategorie},
             success : function (data){
                 $('#zeus_sitebundle_parution_sousCategorie').empty();
                 $.each(data, function(i, item) {
                    if((idSousCategorie == 0 && i == 0) || (idSousCategorie != 0 && item.id == idSousCategorie)){
                        $('#s2id_zeus_sitebundle_parution_sousCategorie .select2-chosen').html(
                                item.codeClassification + ' ' + item.intitule
                        );
                    }
                    $('#zeus_sitebundle_parution_sousCategorie').append(
                        '<option value="' + item.id + '">' + item.codeClassification + ' ' + item.intitule +'</option>'
                    );
                 });
             }
        });          
    }	
    
    $(document).ready(function() {
        var sous_cat = 0;
        $('form').append('<input type="hidden" name="sous_cat" value="' + 0 + '" />');
        maj_sous_cat_dispo();
        $("body").on('change', '#zeus_sitebundle_parution_categorie', maj_sous_cat_dispo);
    });
</script>


    <h1 class="h1Parution">Ajouter une Parution</h1>
    <div class="well formulaire">
	<form method="post" {{ form_enctype(form) }}>
            {{ form_label(form.titre, "Titre") }} {{ form_widget(form.titre) }} {{ form_errors(form.titre) }} <br />
            {{ form_label(form.resume, "Résumé") }} {{ form_widget(form.resume) }} {{ form_errors(form.resume) }} <br />
            {{ form_label(form.auteurs, "Auteur(s)") }} {{ form_widget(form.auteurs) }} {{ form_errors(form.auteurs) }} <br />
            {{ form_label(form.traducteurs, "Traducteur(s)") }} {{ form_widget(form.traducteurs) }} {{ form_errors(form.traducteurs) }} <br />
            {{ form_label(form.categorie, "Catégorie") }} {{ form_widget(form.categorie) }} {{ form_errors(form.categorie) }} <br />
            {{ form_label(form.sousCategorie, "Sous catégorie") }} {{ form_widget(form.sousCategorie) }} {{ form_errors(form.sousCategorie) }} <br />
            {{ form_label(form.imageParution, "Image") }} {{ form_widget(form.imageParution) }} {{ form_errors(form.imageParution) }} <br />
            {{ form_label(form.type, "Type") }} {{ form_widget(form.type) }} {{ form_errors(form.type) }} <br />
            {{ form_widget(form.ajouter) }}
	</form>
    </div>


